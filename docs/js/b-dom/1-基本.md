# WebAPI基本知识

WebAPI就是使用JS去操作html和浏览器，包括：DOM（文档对象模型）、BOM（浏览器对象模型）。

<img src="https://raw.githubusercontent.com/hughxusu/lesson-web/develop/images/d-js/js-frame.png" style="zoom: 70%;" />

## DOM

DOM（Document Object Model——文档对象模型）是用来呈现以及与任意HTML或XML文档交互的API。DOM作用是开发网页内容特效和实现用户交互。

### DOM树

将HTML文档以树状结构直观的表现出来，称之为文档树或DOM树，文档树直观的体现了标签与标签之间的关系。

<img src="https://raw.githubusercontent.com/hughxusu/lesson-web/develop/images/d-js/dom.jpg" style="zoom:60%;" />

DOM对象：

* 浏览器根据html标签生成的JS对象。
* 标签所有属性都映射在这个对象上。
* 修改这个对象的属性会，同时会自动反映在标签上。
* DOM对象使得网页节点当做对象来处理。

```html
<style>
    button {
        padding: 10px 20px;
        border: 1px solid #000;
        border-radius: 5px;
        background-color: #f0f0f0;
        cursor: pointer;
        font-size: 20px;
    }
</style>
<button>click me</button>
<script>
    let btn = document.querySelector('button')
    console.log(typeof btn)
    console.dir(btn)

    let count = 1
    btn.addEventListener('click', function () {
    		btn.innerHTML = `click me ${count++}`
    })
</script>
```

`document`对象，是DOM里提供的一个对象：

* `document`提供的属性和方法都是用来访问和操作网页内容。
* 网页所有内容都在`document`里面。

### 获取DOM对象

操作标签的第一步是选中标签，类似CSS的选择器。

1. ` document.querySelector('')`选择匹配的第一个元素。
* 参数：包含一个或多个有效的CSS选择器字符串。
  
* 返回值：CSS选择器匹配的第一个元素,一个HTMLElement对象，如果没有匹配到，则返回`null`。

2. ` document.querySelectorAll('')` 选择匹配的多个元素。
* 参数：包含一个或多个有效的CSS选择器字符串。
  
* 返回值：得到的是一个伪数组（有长度有索引号的数组，但是没有 `pop()` `push()` 等数组方法）。

```html
<body>
    <div>空山不见人</div>
    <div>但闻人语响</div>
    <div class="three">返景入深林</div>
    <ul>
        <li>北斗七星高</li>
        <li>哥舒夜带刀</li>
        <li>至今窥牧马</li>
    </ul>
    <span>不敢过临洮</span>
</body>
<script>
    let div = document.querySelector('div')
    console.log(div)

    let div = document.querySelector('.three')
    console.log(div)

    let li = document.querySelector('ul li:last-child')
    console.log(li)

    let lis = document.querySelectorAll('ul li')
    console.log(lis)
    for (let i = 0; i < lis.length; i++) {
        console.log(lis[i])
    }

    let spans = document.querySelectorAll('span')
    console.log(spans)
</script>
```

3. 其它获取 DOM 元素方法（了解）

   * `document.getElementById()` 根据 id 获取一个元素。

   * `document.getElementsByTagName()` 根据标签获取一类元素。

   *  `document.getElementsByClassName()` 根据类元素获取页面元素。

```html
<body>
    <h3>归山深浅去</h3>
    <p id="two">须尽丘壑美</p>
    <p class="three">莫学武陵人</p>
</body>
<script>
    let one = document.querySelector('h3')
    console.log(one)

    let two = document.querySelector('#two')
    console.log(two)

    let three = document.querySelector('.three')
    console.log(three)
</script>
```

## 操作DOM对象

### 修改元素内容

1. `document.write()`只能将文本内容追加到前面的位置。
2. `innerText`：将文本内容添加/更新到任意标签位置，文本中包含的**标签不会被解析**。
3. `innerHTML`：将文本内容添加/更新到任意标签位置，文本中包含的**标签会被解析**。

```html
<body>
    <div></div>
</body>
<script>
    let div = document.querySelector('div')
    div.innerText = '银烛秋光冷画屏'

    div.innerText += `<h1>轻罗小扇扑流萤</h1>`
    div.innerHTML += `天阶夜色凉如水`
    div.innerHTML += `<h1>卧看牵牛织女星</h1>`
</script>
```

### 修改元素常规属性

通过JS可以设置或修改元素的属性，常见的属性如：`href`、`title`、`src` 等，可以通过`src`更换图片。

```html
<style>
    .show {
        width: 600px;
        margin: 40px auto;
        text-align: center;
    }
</style>
<body>
    <div class="show">
        <img src="" width="600">
    </div>
</body>
<script>
    function getRandom(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min
    }

    let path = 'https://raw.githubusercontent.com/hughxusu/lesson-web/develop/images/material/silder/'
    let arr = ['naz1.jpg', 'naz2.jpg', 'naz3.jpg', 'naz4.jpg', 'naz5.jpg', 'naz6.jpg', 'naz7.jpg']
    let randomIndex = getRandom(0, arr.length - 1)
    let img = document.querySelector('img')
    img.src = path + arr[randomIndex]
    img.title = randomIndex
</script>
```

### 修改元素样式

通过JS可以设置或修改元素的样式，常用的修改方法有三种：

1. 通过`style`修改元素样式

```html
<style>
    div {
        width: 200px;
        height: 200px;
        background-color: purple;
    }
</style>
<body>
    <div></div>
</body>
<script>
    function getRandom(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min
    }

    let colors = ['red', 'blue', 'pink', 'skyblue', 'orange', 'purple']

    let box = document.querySelector('div')
    box.style.backgroundColor = colors[getRandom(0, colors.length)]
    box.style.width = getRandom(2, 5) * 100 + 'px'
    box.style.height = getRandom(2, 5) * 100 + 'px'
</script>
```

* 样式属性名一定是CSS中已有的样式。
* 如果属性有-连接符，需要转换为小驼峰命名法，如：`backgroundColor`等。
* 修改后部分样式属性需要加CSS单位。

2. 通过`className`修改元素样式，可以为元素添加新的样式。

```html
<style>
    .text {
        font-size: 24px;
        line-height: 1.5;
        margin: 40px auto;
    }

    .box {
        text-align: center;
        background-color: skyblue;
        width: 200px;
        padding: 24px;
        border: 2px solid gray;
    }
</style>
<body>
    <div class="text">
        岐王宅里寻常见，<br>
        崔九堂前几度闻。<br>
        正是江南好风景，<br>
        落花时节又逢君。
    </div>
</body>
<script>
    let box = document.querySelector('.text')
    box.className = 'text box'
</script>
```

* 由于`class`是关键字，所以使用`className`去代替。
* 对`className`赋值会会覆盖原有值，如果是添加类，需要将原有类名和新类名拼接在一起。

使用`+=`运算可以追加元素，使用时要注意类之间的空格。

```js
box.className += ' box'
```

3. 通过`classList`修改元素样式。为了解决`className`容易覆盖以前的类名，可以通过`classList`方式追加和删除类名。
   * `add`追加类名
   * `remove`删除类名
   * `toggle`切换类名（原来有删除，原来没有添加）

```html
<style>
    .text {
        font-size: 24px;
        line-height: 1.5;
        margin: 40px auto;
    }

    .box {
        text-align: center;
        background-color: skyblue;
        width: 200px;
        padding: 24px;
        border: 2px solid gray;
    }
</style>
<body>
    <div class="text">
        岐王宅里寻常见，<br>
        崔九堂前几度闻。<br>
        正是江南好风景，<br>
        落花时节又逢君。
    </div>
</body>
<script>
    let box = document.querySelector('.text')

    // box.classList.add('box')
    // box.classList.remove('text')
    // box.classList.toggle('box')
</script>
```

### 修改表单属性

表单的属性，如：密码、选中项等，均有属性值，使用与其他的标签的属性无差别。

```html
<body>
    <p>
        <input type="text" value="请输入用户名" class="username">
    </p>
    <p>
        <button class="register">免费注册</button>
    </p>
    <p>
        <input type="checkbox" class="agree"> 同意注册协议
    </p>
</body>
<script>
    let username = document.querySelector('.username')
    username.value = 'Harry Potter'
    username.type = 'password'

    let register = document.querySelector('.register')
    register.disabled = true

    let agree = document.querySelector('.agree')
    agree.checked = true
</script>
```

* 只添加时生效的表单属性，使用布尔值，如：`disabled`、`checked`和`selected`

## 定时器

定时器函数`setInterval(func, delay)`

* 每隔`delay`的时间调函数`func`。
* 返回值为定时器`id`。
* 使用`clearInterval(id)`关闭定时器。

```html
<style>
    h1 {
        margin: 40px auto;
        background-color: skyblue;
        padding: 12px;
        border: 2px solid gray;
        width: 200px;
        text-align: center;
    }
</style>
<body>
    <h1>倒计时: 5</h1>
</body>
<script>
    let h1 = document.querySelector('h1')
    let count = 5
    let timer = setInterval(() => {
        count--
        h1.innerHTML = `倒计时: ${count}`
        if (count <= 0) {
            clearInterval(timer)
            h1.innerHTML = '倒计时结束'
        }
    }, 1000)
</script>
```

* 如果要关闭定时器，需要记录定时器`id`。

## 综合案例

定时轮播图

<img src="https://raw.githubusercontent.com/hughxusu/lesson-web/develop/images/d-js/Xnip2025-10-28_22-17-38.jpg" style="zoom:45%;" />

```html
<style>
    .show {
        width: 600px;
        margin: 40px auto 0;
        text-align: center;
    }

    h1 {
        margin: 0;
        border: 2px solid #ccc;
        padding: 10px;
        background-color: skyblue;
    }
</style>
<body>
    <div class="show">
        <img src="" width="100%">
        <h1></h1>
    </div>
</body>
<script>
    let path = 'https://raw.githubusercontent.com/hughxusu/lesson-web/develop/images/material/silder/'
    let arr = [
        { name: 'naz1.jpg', title: '云想衣裳花想容' },
        { name: 'naz2.jpg', title: '春风拂槛露华浓' },
        { name: 'naz3.jpg', title: '若非群玉山头见' },
        { name: 'naz4.jpg', title: '会向瑶台月下逢' },
    ]
    let img = document.querySelector('img')
    img.src = path + arr[0].name

    let title = document.querySelector('.show h1')
    title.innerHTML = arr[0].title

    let index = 0
    setInterval(function() {
        index = (index + 1) % arr.length
        img.src = path + arr[index].name
        title.innerHTML = arr[index].title
    }, 1500)
</script>
```



