# 构建工具

项目构建包括：1、编译项目中的js、sass和less等；2、合并js和css等资源文件；3、压缩js、css、html等资源文件；4、js语法检查。

## Grunt

### 简介

Grunt是一套前端自动化构建工具，基于nodeJs的命令行工具，常用功能包括：1、合并文件js和css；2、压缩文件js和css；3、语法检查js；4、less/sass预编译处理。

```shell
Grunt项目目录结构
├── build # 构建生成的文件所在的文件夹
├── src # 源码文件夹
│   ├── js # js源文件夹 
│   └── css # css源文件夹
├── index.html # 页面文件
├── Gruntfile.js # grunt配置文件（首字母大写）
└── package.json # 项目包配置文件
```

#### 安装

安装命令行工具`npm install -g grunt-cli`

在项目中安装开发依赖`npm install grunt --save-dev`

### 使用

#### 文件配置

配置文件Gruntfile.js是一个node函数类型模块。

配置编码包含3步：1、初始化插件配置；2、加载插件任务；3、注册构建任务。

#### 插件设置

js文件合并，下载插件`npm install grunt-contrib-concat --save-dev`

```javascript
// Gruntfile.js 配置
module.exports = function(grunt) {
	// 初始化配置插件任务
	grunt.initConfig({
		concat: { // 配置js压缩插件
			options: {
				separator: ';', //连接符 ;
			},
			dist: {
				src: ['src/js/*.js'], // 找目标原文件
				dest: 'build/js/build.js', // 输出的文件路径及文件名字
			},
		},
	});
	// grunt任务执行时加载插件
	grunt.loadNpmTasks('grunt-contrib-concat');
	// 注册默认任务  grunt执行任务  同步
	grunt.registerTask('default', []);
};

// grunt命令
grunt concat
```

压缩js文件，下载插件`npm install grunt-contrib-uglify --save-dev`

```javascript
// 配置文件
pkg : grunt.file.readJSON('package.json'),
  uglify : {
    options: {  //不是必须的
      banner: '/*! <%= pkg.name %> - v<%= pkg.version %> - ' +
        '<%= grunt.template.today("yyyy-mm-dd") %> */'
    },
      build: {
        files: {
          'build/js/built-<%=pkg.name%>-<%=pkg.version%>.min.js': ['build/js/built.js']
        }
      }
  }

// 添加插件任务
grunt.loadNpmTasks('grunt-contrib-uglify'); // 文件压缩工具

// grunt命令
grunt uglify 
```

默认任务

```javascript
grunt.registerTask('default', ['concat', 'uglify']); // 设置多个任务，多个任务是同步的

// grunt命令
grunt // 执行所有编译工作
```

js语法检查`npm install grunt-contrib-jshint --save-dev`

```javascript
jshint : {
  options: {
    jshintrc : '.jshintrc' // 指定配置文件，设置语法检查的配置，是一个json格式文件
  },
    build : ['Gruntfile.js', 'src/js/*.js'] // 指定检查的文件
}
```

grunt watch 任务可以监视文件变化自动调用命令。

## Gulp

### 简介

中文主页: http://www.gulpjs.com.cn/

gulp是与grunt功能类似的前端项目构建工具, 也是基于Nodejs的自动任务运行器
  * 能自动化地完成 javascript/coffee/sass/less/html/image/css 等文件的合并、压缩、检查、监听文件变化、浏览器自动刷新、测试等任务
  * gulp更高效（异步多任务），更易于使用，插件高质量

```shell
├── dist # 生成文件夹
├── gulpfile.js # gulp配置文件
├── package-lock.json
├── package.json
└── src # 源文件
    ├── css
    ├── js
    └── less
```

#### 安装

```shell
npm install gulp -g # 全局安装gulp
npm install gulp --save-dev # 局部安装gulp
```

### 使用

js文件合并、压缩和重命名，安装插件`npm install gulp-concat gulp-uglify gulp-rename --save-dev`

```javascript
// 引用gulp
var gulp = require('gulp'); 

// 引用插件
var concat = require('gulp-concat'); 
var rename = require('gulp-rename');
var uglify = require('gulp-uglify');

gulp.task('js', function () { // js文件合并、压缩和重命名
	return gulp.src('src/js/*.js') // 源文件路径，将源文件的数据读取到gulp的内存中
		.pipe($.concat('build.js')) // 合并js文件
		.pipe(gulp.dest('dist/js/')) // 临时输出
		.pipe($.uglify()) // 压缩js文件
		.pipe($.rename({suffix:'.min'})) // 重命名
		.pipe(gulp.dest('dist/js/')) // 输出
});

gulp.task('default', []); // 注册默认任务

// 使用命令
gulp js // js为命令目录
```

css和less编译压缩，安装插件`npm install gulp-less gulp-clean-css --save-dev`

```javascript
var less = require('gulp-less');
var cssClean = require('gulp-clean-css');

gulp.task('less', function () { // 注册编译less的任务
	return gulp.src('src/less/*.less')
		.pipe($.less()) // 将less文件转换为css文件
		.pipe(gulp.dest('src/css/'))
});

gulp.task('css', ['less'], function () { // 注册合并压缩css的任务 ['less']表示依赖less任务
	return gulp.src('src/css/*.css') // return 使得任务为异步任务，去掉return为同步任务
		.pipe($.concat('build.css'))
		.pipe(gulp.dest('dist/css/'))
		.pipe($.rename({suffix:'.min'}))
		.pipe($.cleanCss({compatibility: 'ie8'}))
		.pipe(gulp.dest('dist/css/'))
});

gulp.task('default', []);

gulp less
gulp css
```

注册多个任务

```javascript
gulp.task('default', ['js', 'less', 'css']);

gulp // 执行全部任务
```

## Webpack

### 简介

Webpack作用图

<img src="https://pic4.zhimg.com/v2-428e325a87d01d02923ad2ed4c3e785a_1440w.jpg?source=172ae18b" style="zoom: 45%;" />

#### Webpack概念

Webpack是一个模块打包器（bundler）

* 在Webpack看来，前端的所有资源文件（js、json、css、img、less等）都会作为模块处理。
* 根据模块的依赖关系进行静态分析，生成对应的静态资源。

#### Loader

Webpack本身只能加载JS/JSON模块，如果要加载其他类型的文件（模块），就需要使用对应的loader进行转换。
  * Loader本身是运行在node.js环境中的JavaScript模块
  * Loader是一个函数，接受源文件作为参数，返回转换的结果。
  * loader一般以 xxx-loader的方式命名，xxx代表了这个 loader 要做的转换功能，比如css-loader。

### 使用

在`package.json`中指定Webpack的使用版本。

```json
{
  "name": "webpack_test",
  "version": "1.0.0"
} 
```

安装webpack

```shell
npm install webpack -g  # 全局安装，可以使用webpack命令
npm install webpack --save-dev  # 局部安装，指定使用版本
```

## Vite

vite是一种新型的前端构建工具，能显著提升前端开发的体验。

```shell
# 直接创建相应的开发环境，无需全局安装
yarn create vite
tyarn create vite

# 按照提示选择要开发的项目
tyarn # 安装依赖包

# 打包
tyarn build # 打包结果保存在dist中

# 免费部署测试网址 netlify 可以部署静态页面
```

