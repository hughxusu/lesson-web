# 前端请求

## Ajax

### 概念

同步交互：客户端给服务器发送请求，服务器给客户端一个相应，响应回来的数据会把客户端界面覆盖。

异步交互：客户端给服务器发送请求，服务器给客户端一个响应，响应回来的数据不会把原来的页面覆盖掉。

ajax就是实现页面不刷新，可以直接获取服务器端数据。

### 原理

利用XMLHttpRequest 发送请求，接收数据，并使用js操作dom刷新界面。

![ajax请求流程](https://tva1.sinaimg.cn/large/0081Kckwgy1glad60ouyjj30gn0bnaak.jpg)

### 使用

利用XMLHttpRequest对象去进行交互。

```javascript
// 操作步骤
// 1.创建对象
var xhr=new XMLHttpRequest();
// 2.打开连接，请求方式，提交的地址
xhr.open("get","login.php?username=zhangsan");
// 3.发送数据
xhr.send(null);
// 4.接收数据，只能通过异步的方式，即回调函数的方式
xhr.onreadystatechange = function(){ // xhr属性，监听服务器端状态的改变
  // 在处理的过程当中会不断返回一些状态：0，1，2，3，4
  if(xhr.readyState == 4){ // 如果状态等于4代表响应完成
    if(xhr.status == 200){ // 获取服务器端相应状态码，如果状态码是200，代表响应成功。
      var data = xhr.responseText; // 用来接收服务器响应的数据
      document.querySelector("span").innerHTML=data;
    }
  }
}
```

### 封装

可以调用第三方库来代替原生`XMLHttpRequest`请求：

* jQuery Ajax 方法
* Axios 库

## Axios

轻量级ajax请求库，封装XmlHttpRequest对象，promise风格，可以用在浏览器端和node服务器端使用。

```react
axios.get(url)
.then(response => { // 成功回调返回response对象
  const result = response.data
  const repo = result.items[0]
  this.setState({
    repoName: repo.name,
    repoUrl: repo.html_url
  })
})
.catch(error => { // 失败回调返回error对象
  // debugger
  console.log(error)
  alert('请求失败 '+ error.message)
})
```

## Fetch

原生函数，但老版本浏览器不支持。不再使用XmlHttpRequest对象提交ajax请求，为了兼容低版本的浏览器, 可以引入兼容库fetch.js。

```react
fetch(url, {method: "GET"})
.then(response => response.json())
.then(data => {
    console.log(data)
    if(data.message) {
    alert(`请求失败: ${data.message}`)
  } else {
    const repo = data.items[0]
    this.setState({
      repoName: repo.name,
      repoUrl: repo.html_url
    })
  }
})
```

